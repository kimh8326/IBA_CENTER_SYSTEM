# 필라테스 센터 관리 시스템 기능 명세서

## 📋 프로젝트 개요

### 시스템명
**필라테스 센터 통합 관리 시스템 (Pilates Center Management System)**

### 목적
소규모 필라테스/요가 센터의 회원관리, 수업예약, 일정관리, 결제관리를 통합한 로컬 네트워크 기반 관리 시스템

### 운영 환경
- **서버**: 센터 내부 Wi-Fi 네트워크 (로컬 서버)
- **클라이언트**: 웹, 모바일 앱 (Android/iOS), 데스크톱 앱
- **사용자**: 센터장(마스터), 강사, 회원

---

## 🔐 핵심 권한 시스템

### 권한 분리 원칙
1. **마스터**: 모든 데이터와 기능에 대한 완전한 권한
2. **강사**: 본인이 담당하는 수업과 관련된 데이터만 접근 및 관리 권한
3. **회원**: 본인의 개인 정보와 예약 내역만 접근 권한

### 데이터 접근 제한
- **강사는 다른 강사의 스케줄 수정 불가**
- **강사는 전체 회원 정보 접근 불가** (본인 수업 수강생만 제한적 조회)
- **강사는 센터 운영 정보 및 매출 정보 접근 불가**

---

## 👥 사용자 권한별 기능

### 🔑 마스터 (센터장)
**모든 권한을 가진 최고 관리자 - 센터 운영의 모든 측면을 관리**

#### 🏢 센터 운영 관리
- [ ] 센터 기본 정보 설정 (상호명, 주소, 연락처)
- [ ] 영업 시간 및 휴무일 설정
- [ ] 센터 규정 및 정책 설정
- [ ] 시설 및 장비 관리
- [ ] 백업/복구 시스템 관리

#### 👥 직원 관리 (강사 관리)
- [x] 강사 계정 생성/수정/삭제/활성화
- [ ] 강사 프로필 관리 (자격증, 경력, 사진)
- [ ] 강사별 담당 수업 유형 설정
- [ ] 강사 근무 일정 및 휴가 관리
- [ ] 강사별 급여 및 수당 관리
- [ ] 강사 성과 평가 및 통계

#### 👤 회원 관리
- [x] 회원 등록/수정/삭제
- [x] 회원 목록 조회/검색/필터링
- [ ] 회원권 생성/수정/삭제 (개수형/기간형/무제한)
- [ ] 회원별 수강 이력 전체 조회
- [ ] 회원 상태 관리 (활성/비활성/휴회/탈퇴)
- [ ] 회원 프로필 사진 및 개인정보 관리
- [ ] 회원 메모 및 특이사항 관리
- [ ] 회원 등급 및 VIP 관리

#### 📅 수업 관리 (전체 스케줄 권한)
- [ ] 수업 유형 생성/수정/삭제 (기구필라테스, 매트필라테스, 요가 등)
- [ ] 전체 강사의 수업 시간표 생성/수정/삭제
- [ ] 정기 수업 스케줄 설정 및 관리
- [ ] 임시 수업 추가/변경/취소
- [ ] 수업별 정원 및 최소 인원 설정
- [ ] 수업별 가격 및 할인 정책 설정
- [ ] 홀리데이 및 특별 스케줄 관리

#### 📋 예약 관리 (전체 권한)
- [ ] 전체 예약 현황 실시간 모니터링
- [ ] 예약 강제 생성/수정/취소
- [ ] 전체 대기자 명단 관리 및 정책 설정
- [ ] 노쇼(No-show) 관리 및 패널티 적용
- [ ] 예약 취소 규정 설정 및 관리
- [ ] 예약 알림 및 리마인더 설정

#### 💰 결제 및 재무 관리
- [ ] 회원권 판매 및 결제 처리
- [ ] 결제 방법 관리 (현금/카드/계좌이체/온라인)
- [ ] 환불 및 부분환불 처리
- [ ] 할인 및 프로모션 관리
- [ ] 일별/월별/연별 매출 통계 및 리포트
- [ ] 강사별/수업별 매출 분석
- [ ] 미수금 관리 및 독촉
- [ ] 세무 관련 데이터 관리

#### 📊 통계 및 분석
- [ ] 센터 전체 운영 대시보드
- [ ] 회원 증감 및 이탈률 분석
- [ ] 수업별 인기도 및 수익성 분석
- [ ] 강사별 성과 및 평가 분석
- [ ] 시설 이용률 및 최적화 분석
- [ ] 경쟁사 비교 및 마케팅 분석

### 👨‍🏫 강사 (Instructor)
**본인 담당 수업에 대한 제한적이지만 완전한 관리 권한**

#### 🔒 권한 제한 사항
- **다른 강사의 스케줄**: 조회만 가능, 수정 불가
- **전체 회원 정보**: 접근 불가 (본인 수업 수강생만 제한적 조회)
- **센터 운영 정보**: 접근 불가
- **매출 및 결제 정보**: 접근 불가
- **시스템 설정**: 접근 불가

#### 📅 본인 수업 관리 (완전 권한)
- [ ] **본인 담당 수업 스케줄 조회 및 관리**
- [ ] **본인 수업 예약 현황 실시간 모니터링**
- [ ] **수업 출석 체크 및 지각/조퇴 처리**
- [ ] **수업별 메모 및 특이사항 기록**
- [ ] **임시 휴강 신청** (센터장 승인 필요)
- [ ] **수업 난이도 및 내용 조정**
- [ ] **개인 레슨 스케줄 관리**

#### 👥 수강생 관리 (본인 수업 한정)
- [ ] **본인 수업 수강생 목록 조회**
- [ ] **수강생 프로필 조회** (이름, 수강이력만 - 연락처/결제정보 제외)
- [ ] **수강생별 출석률 및 수업 참여도 확인**
- [ ] **수강생별 수업 메모 작성** (부상, 주의사항, 진도 등)
- [ ] **수강생 개별 상담 기록**
- [ ] **수강생 레벨 및 능력 평가**

#### 📋 예약 관리 (본인 수업 한정)
- [ ] **본인 수업 예약 승인/거부**
- [ ] **본인 수업 대기자 관리**
- [ ] **노쇼 처리 및 기록**
- [ ] **예약 변경 요청 처리**
- [ ] **수업 취소 시 수강생 알림**

#### 📈 개인 성과 관리
- [ ] **본인 수업 출석률 통계**
- [ ] **수강생 만족도 확인**
- [ ] **본인 수업 예약률 통계**
- [ ] **개인 스케줄 캘린더**
- [ ] **수업 준비 체크리스트**

#### 💬 소통 기능
- [ ] **센터장과의 메시지 시스템**
- [ ] **수업 관련 공지사항 작성**
- [ ] **수강생 개별 피드백 제공**
- [ ] **수업 개선 제안**

### 👤 회원 (Member)
**본인 관련 정보에 대한 완전한 접근 및 제한적 관리 권한**

#### 👤 개인 정보 관리
- [ ] **본인 프로필 조회 및 수정**
- [ ] **비밀번호 변경**
- [ ] **연락처 정보 수정**
- [ ] **프로필 사진 업로드**
- [ ] **개인 메모 및 목표 설정**
- [ ] **건강 정보 및 특이사항 입력**

#### 📅 수업 및 예약 관리
- [ ] **전체 수업 스케줄 조회** (예약 가능한 수업만)
- [ ] **수업 예약하기 및 취소하기**
- [ ] **본인 예약 현황 및 일정 조회**
- [ ] **대기자 신청 및 취소**
- [ ] **예약 변경 요청**
- [ ] **수업 리뷰 및 평가 작성**

#### 📊 수강 관리
- [ ] **본인 수강 이력 전체 조회**
- [ ] **잔여 수업 횟수 실시간 확인**
- [ ] **출석률 및 수강 통계**
- [ ] **회원권 만료일 및 갱신 알림**
- [ ] **개인 운동 기록 및 진도**
- [ ] **목표 달성 현황**

#### 💳 결제 및 회원권 관리
- [ ] **본인 결제 내역 조회**
- [ ] **회원권 구매 신청 및 결제**
- [ ] **미수금 확인 및 납부**
- [ ] **할인 혜택 및 프로모션 확인**
- [ ] **결제 방법 관리**
- [ ] **자동결제 설정/해제**

#### 📱 편의 기능
- [ ] **수업 알림 및 리마인더 설정**
- [ ] **센터 공지사항 확인**
- [ ] **강사 메시지 확인**
- [ ] **센터 위치 및 연락처**
- [ ] **FAQ 및 도움말**

---

## 🗂️ 주요 데이터 모델

### 사용자 (Users)
```sql
- id: 사용자 고유 ID
- phone: 전화번호 (로그인 ID)
- password: 비밀번호 (암호화)
- name: 이름
- email: 이메일
- role: 권한 (master/instructor/member)
- is_active: 활성 상태
- created_at: 가입일
- updated_at: 수정일
```

### 회원 상세 정보 (Member_Profiles)
```sql
- user_id: 사용자 ID (FK)
- birth_date: 생년월일
- gender: 성별
- address: 주소
- emergency_contact: 비상연락처
- medical_notes: 의료 특이사항
- profile_image: 프로필 사진
- join_date: 센터 가입일
- member_number: 회원번호
```

### 수업 유형 (Class_Types)
```sql
- id: 수업 유형 ID
- name: 수업명 (기구필라테스, 매트필라테스 등)
- description: 설명
- duration: 수업 시간 (분)
- max_capacity: 최대 인원
- price_per_session: 회당 가격
- is_active: 활성 상태
```

### 수업 스케줄 (Schedules)
```sql
- id: 스케줄 ID
- class_type_id: 수업 유형 ID (FK)
- instructor_id: 강사 ID (FK)
- day_of_week: 요일 (0=일요일, 6=토요일)
- start_time: 시작 시간
- end_time: 종료 시간
- max_participants: 최대 참가자 수
- is_active: 활성 상태
```

### 예약 (Bookings)
```sql
- id: 예약 ID
- member_id: 회원 ID (FK)
- schedule_id: 스케줄 ID (FK)
- booking_date: 예약 날짜
- status: 상태 (confirmed/cancelled/completed/no_show)
- booking_time: 예약 시각
- cancelled_time: 취소 시각
- notes: 메모
```

### 회원권 (Memberships)
```sql
- id: 회원권 ID
- member_id: 회원 ID (FK)
- membership_type: 회원권 유형 (count/period/unlimited)
- total_sessions: 총 수업 횟수 (개수형)
- used_sessions: 사용한 수업 횟수
- start_date: 시작일
- end_date: 종료일
- purchase_price: 구매 금액
- is_active: 활성 상태
```

### 결제 (Payments)
```sql
- id: 결제 ID
- member_id: 회원 ID (FK)
- membership_id: 회원권 ID (FK, nullable)
- amount: 결제 금액
- payment_method: 결제 방법 (cash/card/transfer)
- payment_date: 결제일
- status: 상태 (completed/pending/refunded)
- notes: 메모
```

---

## 🔐 권한별 시스템 접근 매트릭스

### 데이터 접근 권한표

| 기능/데이터 | 마스터 | 강사 | 회원 |
|------------|--------|------|------|
| **사용자 관리** | | | |
| ├ 전체 회원 정보 | ✅ 완전 | ❌ 접근불가 | ❌ 접근불가 |
| ├ 본인 수업 수강생 | ✅ 완전 | ✅ 제한적 | ❌ 접근불가 |
| ├ 강사 정보 관리 | ✅ 완전 | ❌ 접근불가 | ❌ 접근불가 |
| └ 본인 프로필 | ✅ 완전 | ✅ 완전 | ✅ 완전 |
| **스케줄 관리** | | | |
| ├ 전체 스케줄 수정 | ✅ 완전 | ❌ 불가 | ❌ 불가 |
| ├ 본인 스케줄 관리 | ✅ 완전 | ✅ 완전 | ❌ 불가 |
| ├ 다른 강사 스케줄 | ✅ 완전 | 📖 조회만 | 📖 조회만 |
| └ 스케줄 조회 | ✅ 완전 | ✅ 전체 | ✅ 예약가능한것만 |
| **예약 관리** | | | |
| ├ 전체 예약 관리 | ✅ 완전 | ❌ 불가 | ❌ 불가 |
| ├ 본인 수업 예약 | ✅ 완전 | ✅ 완전 | ❌ 불가 |
| ├ 본인 예약 | ✅ 완전 | ✅ 완전 | ✅ 완전 |
| └ 예약 생성 | ✅ 모든수업 | ❌ 불가 | ✅ 일반수업만 |
| **결제/매출** | | | |
| ├ 전체 매출 정보 | ✅ 완전 | ❌ 접근불가 | ❌ 접근불가 |
| ├ 본인 관련 매출 | ✅ 완전 | ❌ 접근불가 | ❌ 접근불가 |
| └ 본인 결제내역 | ✅ 완전 | ✅ 완전 | ✅ 완전 |
| **시스템 설정** | | | |
| └ 모든 시스템 설정 | ✅ 완전 | ❌ 접근불가 | ❌ 접근불가 |

### 강사 권한 상세 시나리오

#### 시나리오 1: 강사 A의 수업 관리
```
강사 A 담당 수업: 월/수/금 10:00 기구필라테스
강사 B 담당 수업: 화/목 14:00 매트필라테스

강사 A 로그인 시:
✅ 월/수/금 10:00 수업 → 예약현황 조회, 출석체크, 메모작성 가능
✅ 본인 수업 수강생 → 이름, 출석률, 수강이력 조회 가능
❌ 화/목 14:00 수업 → 조회만 가능, 수정/출석체크 불가
❌ 강사 B 수업 수강생 → 접근 불가
❌ 전체 회원 연락처/결제정보 → 접근 불가
```

#### 시나리오 2: 데이터 필터링 로직
```sql
-- 강사가 조회할 수 있는 예약 목록
SELECT b.*, u.name as member_name 
FROM bookings b
JOIN schedules s ON b.schedule_id = s.id  
JOIN users u ON b.member_id = u.id
WHERE s.instructor_id = :current_instructor_id

-- 강사가 조회할 수 있는 회원 목록 (본인 수업 수강생만)
SELECT DISTINCT u.id, u.name, u.phone
FROM users u
JOIN bookings b ON u.id = b.member_id
JOIN schedules s ON b.schedule_id = s.id  
WHERE s.instructor_id = :current_instructor_id
AND u.role = 'member'
```

---

## 🎯 핵심 비즈니스 로직

### 권한 기반 접근 제어
1. **API 레벨 권한 검증**
   - 모든 API 요청시 JWT 토큰으로 사용자 권한 확인
   - 강사의 경우 본인 담당 데이터만 필터링하여 반환
   - 권한 없는 요청은 403 Forbidden 응답

2. **프론트엔드 권한 분기**
   - 로그인 후 사용자 role에 따른 메뉴 및 기능 분기
   - 강사는 "내 수업 관리", 회원은 "예약하기" 중심 UI
   - 마스터는 전체 관리 대시보드 접근

3. **데이터 소유권 검증**
   - 강사가 스케줄 수정 시 `instructor_id = 본인ID` 검증
   - 회원이 예약 취소 시 `member_id = 본인ID` 검증
   - 교차 참조를 통한 권한 검증

### 예약 시스템
1. **예약 가능 조건**
   - 회원권이 유효한 상태 (잔여횟수 > 0 또는 기간 내)
   - 수업 정원이 초과되지 않음
   - 예약 마감 시간 전 (수업 시작 1시간 전까지)
   - 동일 시간대 중복 예약 불가
   - 강사 승인이 필요한 수업의 경우 승인 후 확정

2. **대기자 시스템**  
   - 정원 초과 시 자동으로 대기자 등록
   - 취소 발생 시 대기자 순서대로 자동 승격 (FIFO)
   - 대기자 승격 시 실시간 알림 발송
   - 승격 후 일정 시간 내 미응답시 다음 대기자로 넘어감

3. **취소 규정**
   - 수업 시작 2시간 전까지 취소 가능 (수업 복구)
   - 2시간 이내 취소는 수업 차감 + 부분 복구 가능
   - 노쇼는 수업 차감 + 패널티 점수 누적
   - 연속 노쇼 3회 시 예약 제한 (7일간)

### 강사 스케줄 관리 시스템
1. **스케줄 소유권**
   - 각 스케줄은 하나의 강사에게만 할당
   - 강사는 본인 스케줄만 수정 가능
   - 다른 강사 스케줄 수정은 센터장 권한 필요

2. **스케줄 충돌 방지**
   - 동일 강사의 동시간대 수업 등록 불가
   - 시설/장비 중복 사용 방지
   - 휴강 신청 시 자동으로 해당 시간대 예약 불가 처리

3. **임시 스케줄 관리**
   - 정규 스케줄과 별도의 임시 수업 생성 가능
   - 강사 개인 레슨 스케줄 독립 관리
   - 대체 강사 지정 시스템

### 회원권 시스템
1. **개수형 회원권**
   - 정해진 횟수만큼 수업 수강 가능
   - 사용 기한 설정 가능
   - 잔여 횟수 실시간 관리

2. **기간형 회원권**
   - 설정된 기간 동안 무제한 수강
   - 일일 수강 제한 설정 가능
   - 휴회/연장 관리

3. **무제한 회원권**
   - 제한 없이 모든 수업 수강 가능
   - VIP 회원 전용

### 출석 관리
1. **출석 체크**
   - QR 코드 스캔 또는 수동 체크
   - 지각/조퇴 관리
   - 출석률 통계

2. **노쇼 관리**
   - 무단 결석 시 자동 노쇼 처리
   - 노쇼 누적 시 예약 제한
   - 노쇼 패널티 부과

---

## 📊 리포트 및 통계

### 매출 분석
- [ ] 일별/주별/월별 매출
- [ ] 결제 방법별 매출
- [ ] 수업별 매출
- [ ] 강사별 매출 기여도

### 회원 분석
- [ ] 신규 회원 증가 추이
- [ ] 회원 이탈률 분석
- [ ] 출석률 통계
- [ ] 인기 수업 분석

### 운영 분석
- [ ] 수업별 예약률
- [ ] 시간대별 이용률
- [ ] 강사별 평가
- [ ] 취소율 분석

---

## 🚀 개발 우선순위

### Phase 1: 핵심 기능 (필수)
1. [x] 사용자 인증 시스템
2. [ ] 회원 기본 CRUD
3. [ ] 수업 스케줄 관리
4. [ ] 기본 예약 시스템
5. [ ] 회원권 기본 관리

### Phase 2: 확장 기능
1. [ ] 대기자 시스템
2. [ ] 출석 체크 시스템
3. [ ] 결제 관리
4. [ ] 기본 리포트

### Phase 3: 고급 기능
1. [ ] 고급 통계 및 분석
2. [ ] 모바일 푸시 알림
3. [ ] 자동 백업 시스템
4. [ ] API 확장

---

## 🔧 기술 요구사항

### 보안
- [ ] 비밀번호 암호화 (bcrypt)
- [ ] JWT 토큰 기반 인증
- [ ] SQL Injection 방지
- [ ] XSS 방지
- [ ] CSRF 토큰

### 성능
- [ ] 데이터베이스 인덱싱
- [ ] 캐싱 시스템
- [ ] 페이지네이션
- [ ] 이미지 최적화
- [ ] 백그라운드 작업 처리

### 사용성
- [ ] 반응형 디자인
- [ ] 다크모드 지원
- [ ] 키보드 단축키
- [ ] 오프라인 모드 (제한적)
- [ ] 데이터 Export/Import

---

## 📱 UI/UX 요구사항

### 공통 UI 컴포넌트
- [ ] 네비게이션 메뉴
- [ ] 사용자 프로필 드롭다운
- [ ] 검색 기능
- [ ] 필터링 기능
- [ ] 페이지네이션
- [ ] 로딩 스피너
- [ ] 에러 메시지
- [ ] 확인 다이얼로그

### 모바일 최적화
- [ ] 터치 친화적 버튼 크기
- [ ] 스와이프 제스처
- [ ] 풀다운 새로고침
- [ ] 무한 스크롤
- [ ] 오프라인 표시

---

## 🧪 테스트 계획

### 단위 테스트
- [ ] API 엔드포인트 테스트
- [ ] 데이터베이스 쿼리 테스트
- [ ] 비즈니스 로직 테스트
- [ ] 인증/권한 테스트

### 통합 테스트
- [ ] 사용자 시나리오 테스트
- [ ] API 통합 테스트
- [ ] 데이터베이스 무결성 테스트

### 사용자 테스트
- [ ] 실제 센터에서의 베타 테스트
- [ ] 다양한 기기에서의 호환성 테스트
- [ ] 네트워크 환경별 성능 테스트

---

이 명세서를 바탕으로 단계별로 기능을 구현해나가겠습니다. 가장 중요한 기능부터 우선 개발하시겠습니까?